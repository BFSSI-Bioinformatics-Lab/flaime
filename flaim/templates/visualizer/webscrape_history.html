{% load static i18n %}
<div class="row justify-content-center">
  <div id="scrapeChart"></div>
</div>

{% block extra_js %}
  <script src="{% static 'axios/dist/axios.js' %}"></script>
  <script src="{% static 'plotly.js-dist/plotly.js' %}"></script>

  <script>
    axios.get("/api/scrape_batches")
            .then(function (response) {
              console.log(response);
              let results = response.data.results;

              // Filter the data into two separate sets
              let walmart_results = results.filter(x => x.store === "WALMART")
              let loblaws_results = results.filter(x => x.store === "LOBLAWS")
              let voila_results = results.filter(x => x.store === "VOILA")
              let gateway_results = results.filter(x => x.store === "GROCERYGATEWAY")

              // Trace setup
              let walmart_trace = {
                x: walmart_results.map(x => x.scrape_date),
                y: walmart_results.map(x => x.total_products),
                type: 'bar',
                name: 'Walmart'
              }

              let loblaws_trace = {
                x: loblaws_results.map(x => x.scrape_date),
                y: loblaws_results.map(x => x.total_products),
                type: 'bar',
                name: 'Loblaws'
              }

              let voila_trace = {
                x: voila_results.map(x => x.scrape_date),
                y: voila_results.map(x => x.total_products),
                type: 'bar',
                name: 'Voila'
              }


              let gateway_trace = {
                x: gateway_results.map(x => x.scrape_date),
                y: gateway_results.map(x => x.total_products),
                type: 'bar',
                name: 'Grocery Gateway'
              }


              let data = [walmart_trace, loblaws_trace, voila_trace, gateway_trace]

              let layout = {
                autosize: true,
                title: {
                  text: 'Web Scraping History',
                  font: {
                    size: 24
                  },
                  xref: 'paper',
                },
                xaxis: {
                  title: {
                    text: 'Date',
                    font: {
                      size: 18,
                    }
                  },
                },
                yaxis: {
                  title: {
                    text: 'Number of Products Collected',
                    font: {
                      size: 18,
                    }
                  }
                },
                showlegend: true,
              };

              Plotly.newPlot('scrapeChart', data, layout);

            })
            .catch(function (error) {
              console.log(error)
            })
            .finally(function () {
            });


  </script>


{% endblock %}
